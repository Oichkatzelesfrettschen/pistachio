%!PS-Adobe-2.0
%%Creator: dvips 5.83 (MiKTeX 1.20b) Copyright 1998 Radical Eye Software
%%Title: C:\Home\l4-x-smp\smp-design.dvi
%%CreationDate: Fri Dec 17 00:28:17 1999
%%Pages: 5
%%PageOrder: Ascend
%%BoundingBox: 0 0 612 792
%%DocumentFonts: Times-Italic Helvetica-Bold Times-Roman Helvetica
%%+ Times-BoldItalic
%%EndComments
%DVIPSWebPage: (www.radicaleye.com)
%DVIPSCommandLine: C:\utility\miktex\texmf\miktex\bin\dvips.exe
%+ -osmp_design.ps C:\Home\l4-x-smp\smp-design.dvi
%DVIPSParameters: dpi=600, compressed
%DVIPSSource:  TeX output 1999.12.10:2241
%%BeginProcSet: texc.pro
%!
/TeXDict 300 dict def TeXDict begin/N{def}def/B{bind def}N/S{exch}N/X{S
N}B/A{dup}B/TR{translate}N/isls false N/vsize 11 72 mul N/hsize 8.5 72
mul N/landplus90{false}def/@rigin{isls{[0 landplus90{1 -1}{-1 1}ifelse 0
0 0]concat}if 72 Resolution div 72 VResolution div neg scale isls{
landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div hsize
mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul TR[
matrix currentmatrix{A A round sub abs 0.00001 lt{round}if}forall round
exch round exch]setmatrix}N/@landscape{/isls true N}B/@manualfeed{
statusdict/manualfeed true put}B/@copies{/#copies X}B/FMat[1 0 0 -1 0 0]
N/FBB[0 0 0 0]N/nn 0 N/IEn 0 N/ctr 0 N/df-tail{/nn 8 dict N nn begin
/FontType 3 N/FontMatrix fntrx N/FontBBox FBB N string/base X array
/BitMaps X/BuildChar{CharBuilder}N/Encoding IEn N end A{/foo setfont}2
array copy cvx N load 0 nn put/ctr 0 N[}B/sf 0 N/df{/sf 1 N/fntrx FMat N
df-tail}B/dfs{div/sf X/fntrx[sf 0 0 sf neg 0 0]N df-tail}B/E{pop nn A
definefont setfont}B/Cw{Cd A length 5 sub get}B/Ch{Cd A length 4 sub get
}B/Cx{128 Cd A length 3 sub get sub}B/Cy{Cd A length 2 sub get 127 sub}
B/Cdx{Cd A length 1 sub get}B/Ci{Cd A type/stringtype ne{ctr get/ctr ctr
1 add N}if}B/id 0 N/rw 0 N/rc 0 N/gp 0 N/cp 0 N/G 0 N/CharBuilder{save 3
1 roll S A/base get 2 index get S/BitMaps get S get/Cd X pop/ctr 0 N Cdx
0 Cx Cy Ch sub Cx Cw add Cy setcachedevice Cw Ch true[1 0 0 -1 -.1 Cx
sub Cy .1 sub]/id Ci N/rw Cw 7 add 8 idiv string N/rc 0 N/gp 0 N/cp 0 N{
rc 0 ne{rc 1 sub/rc X rw}{G}ifelse}imagemask restore}B/G{{id gp get/gp
gp 1 add N A 18 mod S 18 idiv pl S get exec}loop}B/adv{cp add/cp X}B
/chg{rw cp id gp 4 index getinterval putinterval A gp add/gp X adv}B/nd{
/cp 0 N rw exit}B/lsh{rw cp 2 copy get A 0 eq{pop 1}{A 255 eq{pop 254}{
A A add 255 and S 1 and or}ifelse}ifelse put 1 adv}B/rsh{rw cp 2 copy
get A 0 eq{pop 128}{A 255 eq{pop 127}{A 2 idiv S 128 and or}ifelse}
ifelse put 1 adv}B/clr{rw cp 2 index string putinterval adv}B/set{rw cp
fillstr 0 4 index getinterval putinterval adv}B/fillstr 18 string 0 1 17
{2 copy 255 put pop}for N/pl[{adv 1 chg}{adv 1 chg nd}{1 add chg}{1 add
chg nd}{adv lsh}{adv lsh nd}{adv rsh}{adv rsh nd}{1 add adv}{/rc X nd}{
1 add set}{1 add clr}{adv 2 chg}{adv 2 chg nd}{pop nd}]A{bind pop}
forall N/D{/cc X A type/stringtype ne{]}if nn/base get cc ctr put nn
/BitMaps get S ctr S sf 1 ne{A A length 1 sub A 2 index S get sf div put
}if put/ctr ctr 1 add N}B/I{cc 1 add D}B/bop{userdict/bop-hook known{
bop-hook}if/SI save N @rigin 0 0 moveto/V matrix currentmatrix A 1 get A
mul exch 0 get A mul add .99 lt{/QV}{/RV}ifelse load def pop pop}N/eop{
SI restore userdict/eop-hook known{eop-hook}if showpage}N/@start{
userdict/start-hook known{start-hook}if pop/VResolution X/Resolution X
1000 div/DVImag X/IEn 256 array N 2 string 0 1 255{IEn S A 360 add 36 4
index cvrs cvn put}for pop 65781.76 div/vsize X 65781.76 div/hsize X}N
/p{show}N/RMat[1 0 0 -1 0 0]N/BDot 260 string N/Rx 0 N/Ry 0 N/V{}B/RV/v{
/Ry X/Rx X V}B statusdict begin/product where{pop false[(Display)(NeXT)
(LaserWriter 16/600)]{A length product length le{A length product exch 0
exch getinterval eq{pop true exit}if}{pop}ifelse}forall}{false}ifelse
end{{gsave TR -.1 .1 TR 1 1 scale Rx Ry false RMat{BDot}imagemask
grestore}}{{gsave TR -.1 .1 TR Rx Ry scale 1 1 false RMat{BDot}
imagemask grestore}}ifelse B/QV{gsave newpath transform round exch round
exch itransform moveto Rx 0 rlineto 0 Ry neg rlineto Rx neg 0 rlineto
fill grestore}B/a{moveto}B/delta 0 N/tail{A/delta X 0 rmoveto}B/M{S p
delta add tail}B/b{S p tail}B/c{-4 M}B/d{-3 M}B/e{-2 M}B/f{-1 M}B/g{0 M}
B/h{1 M}B/i{2 M}B/j{3 M}B/k{4 M}B/w{0 rmoveto}B/l{p -4 w}B/m{p -3 w}B/n{
p -2 w}B/o{p -1 w}B/q{p 1 w}B/r{p 2 w}B/s{p 3 w}B/t{p 4 w}B/x{0 S
rmoveto}B/y{3 2 roll p a}B/bos{/SS save N}B/eos{SS restore}B end

%%EndProcSet
%%BeginProcSet: 8r.enc
% @@psencodingfile@{
%   author = "S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry",
%   version = "0.6",
%   date = "1 July 1998",
%   filename = "8r.enc",
%   email = "tex-fonts@@tug.org",
%   docstring = "Encoding for TrueType or Type 1 fonts
%                to be used with TeX."
% @}
% 
% Idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard Encoding + ISO Latin 1 + extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% 
% (4) Remaining positions left undefined are for use in (hopefully)
% upward-compatible revisions, if someday more characters are generally
% available.
% 
% (5) hyphen appears twice for compatibility with both 
% ASCII and Windows.
% 
/TeXBase1Encoding [
% 0x00 (encoded characters from Adobe Standard not in Windows 3.1)
  /.notdef /dotaccent /fi /fl
  /fraction /hungarumlaut /Lslash /lslash
  /ogonek /ring /.notdef
  /breve /minus /.notdef 
% These are the only two remaining unencoded characters, so may as
% well include them.
  /Zcaron /zcaron 
% 0x10
 /caron /dotlessi 
% (unusual TeX characters available in, e.g., Lucida Bright)
 /dotlessj /ff /ffi /ffl 
 /.notdef /.notdef /.notdef /.notdef
 /.notdef /.notdef /.notdef /.notdef
 % very contentious; it's so painful not having quoteleft and quoteright
 % at 96 and 145 that we move the things normally found there to here.
 /grave /quotesingle 
% 0x20 (ASCII begins)
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three /four /five /six /seven
 /eight /nine /colon /semicolon /less /equal /greater /question
% 0x40
 /at /A /B /C /D /E /F /G /H /I /J /K /L /M /N /O
% 0x50
 /P /Q /R /S /T /U /V /W
 /X /Y /Z /bracketleft /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o
% 0x70
 /p /q /r /s /t /u /v /w
 /x /y /z /braceleft /bar /braceright /asciitilde
 /.notdef % rubout; ASCII ends
% 0x80
 /.notdef /.notdef /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /.notdef /.notdef /.notdef
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /.notdef /.notdef /Ydieresis
% 0xA0
 /.notdef % nobreakspace
 /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot
 /hyphen % Y&Y (also at 45); Windows' softhyphen
 /registered
 /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def

%%EndProcSet
%%BeginProcSet: texps.pro
%!
TeXDict begin/rf{findfont dup length 1 add dict begin{1 index/FID ne 2
index/UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]/Metrics
exch def dict begin Encoding{exch dup type/integertype ne{pop pop 1 sub
dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get div def}
ifelse}forall Metrics/Metrics currentdict end def[2 index currentdict
end definefont 3 -1 roll makefont/setfont cvx]cvx def}def/ObliqueSlant{
dup sin S cos div neg}B/SlantFont{4 index mul add}def/ExtendFont{3 -1
roll mul exch}def/ReEncodeFont{CharStrings rcheck{/Encoding false def
dup[exch{dup CharStrings exch known not{pop/.notdef/Encoding true def}
if}forall Encoding{]exch pop}{cleartomark}ifelse}if/Encoding exch def}
def end

%%EndProcSet
TeXDict begin 40258431 52099146 1000 600 600
(C:\Home\l4-x-smp/C:\Home\l4-x-smp\smp-design.dvi) @start
%DVIPSBitmapFont: Fa cmmi8 8 1
/Fa 1 111 df<3907C007E0391FE03FF83918F8783E393879E01E39307B801F38707F00
126013FEEAE0FC12C05B00815C0001143E5BA20003147E157C5B15FC0007ECF8081618EB
C00115F0000F1538913803E0300180147016E0001F010113C015E390C7EAFF00000E143E
251F7E9D2B>110 D E
%EndDVIPSBitmapFont
/Fb 134[29 29 44 29 33 18 26 26 1[33 33 33 48 18 29 1[18
33 33 18 29 33 29 1[33 6[37 9[41 1[44 12[41 6[22 1[33
1[33 7[17 22 5[22 35[33 3[{TeXBase1Encoding ReEncodeFont}33
66.4176 /Times-Italic rf /Fc 134[42 1[58 1[46 25 42 29
46 46 46 46 66 21 42 1[21 46 46 25 42 46 42 46 42 12[46
1[54 1[50 4[54 1[21 5[54 54 13[42 1[42 42 2[21 25 42[46
2[{TeXBase1Encoding ReEncodeFont}35 74.7198 /Helvetica-Bold
rf /Fd 135[37 54 1[37 21 29 25 5[21 2[21 37 37 1[33 37
33 1[33 48[37 6[25 25 40[{.167 SlantFont TeXBase1Encoding ReEncodeFont}
17 74.7198 /Times-Roman rf /Fe 140[29 3[37 42 4[21 1[37
1[33 37 33 1[37 28[54 9[25 6[37 37 37 49[{TeXBase1Encoding ReEncodeFont}
14 74.7198 /Times-BoldItalic rf
%DVIPSBitmapFont: Ff cmsy9 9 1
/Ff 1 16 df<EB1FC0EBFFF8487F000713FF4814804814C04814E0A24814F0A2B612F8A9
6C14F0A26C14E0A26C14C06C14806C1400000113FC6C5BEB1FC01D1D7CA126>15
D E
%EndDVIPSBitmapFont
/Fg 135[37 2[42 21 37 25 5[17 3[42 42 1[42 42 37 1[42
97[{TeXBase1Encoding ReEncodeFont}12 74.7198 /Helvetica
rf
%DVIPSBitmapFont: Fh cmmi9 9 4
/Fh 4 117 df<1307D90FC01338011F147C16FC5CA2013F1301A202005BA2491303A201
7E5CA201FE1307A2495CA20001140FA2495C17800003021F13C016C149EC8180A20007EC
3F836D017F130016034B5A3A0FFC03CF869039FE070F8E9039DFFE07FC9039C3F801F0D8
1FC0C9FCA25BA2123FA290CAFCA25AA2127EA212FEA25A12382A327FA02E>22
D<EB01C0EB07E014F0130F14E01307EB038090C7FCAA13F0EA03FCEA071EEA0E1F121C12
3800301380EB3F00127012605BEAE07EEA40FE12005B12015BA212035B12071420EBE070
000F136013C014E014C0EA1F80EA0F81EB8380EB8700EA078EEA03FCEA00F014337EB11A
>105 D<EB07E0EA03FFA25CEA001FA35CA3133F91C8FCA35B137EA313FE49131FED7FC0
EC01E0000190380383E09038F8070F140E141C0003013813C0EBF0709138E00700D9F1C0
C7FC3807F78001EEC8FC13FC7F380FFFE0EBC7F8EBC1FEEBC07E001F7F1380ED8080ED81
C0003FEC01801300A21503481500007EEB3E071506EC1F0E00FE5C48EB07F80038EB03E0
23357DB328>107 D<EB0380EB0FC0A3131FA21480A2133FA21400A25BA2137E387FFFFE
A2B5FC3800FC00A21201A25BA21203A25BA21207A25BA2120FA25B1408001F131C141813
80143814701460EB00E0EB01C0380F8380EB8700EA07FEEA01F817307FAE1C>116
D E
%EndDVIPSBitmapFont
/Fi 105[33 1[29 29 24[29 33 33 48 33 33 18 26 22 33 33
33 33 52 18 33 1[18 33 33 22 29 33 29 33 29 6[41 1[48
1[48 48 41 37 2[37 48 48 59 3[22 48 1[37 41 1[44 44 48
7[33 33 1[33 33 33 1[33 33 33 18 17 22 17 4[22 35[37
37 2[{TeXBase1Encoding ReEncodeFont}60 66.4176 /Times-Roman
rf /Fj 205[25 25 49[{TeXBase1Encoding ReEncodeFont}2
49.8132 /Times-Roman rf /Fk 134[46 46 65 46 51 28 46
32 1[51 51 51 74 23 46 1[23 51 51 28 46 51 46 51 46 10[55
1[51 55 2[55 1[60 69 51 60 1[23 1[65 2[60 60 60 60 11[46
46 46 46 46 2[23 28 23 44[{TeXBase1Encoding ReEncodeFont}45
83.022 /Helvetica-Bold rf /Fl 134[33 33 50 33 37 21 29
29 37 37 37 37 54 21 33 1[21 37 37 21 33 37 33 37 37
10[46 1[42 37 2[46 1[50 62 42 2[25 54 54 46 1[54 50 1[46
6[25 4[37 2[37 37 1[21 19 25 19 2[25 25 36[37 3[{
TeXBase1Encoding ReEncodeFont}49 74.7198 /Times-Italic
rf /Fm 105[37 1[33 33 24[33 37 37 54 37 37 21 29 25 37
37 37 37 58 21 37 21 21 37 37 25 33 37 33 37 33 9[71
54 54 46 42 50 54 42 54 54 66 46 54 1[25 54 1[42 46 54
50 50 54 5[21 21 1[37 37 37 37 37 37 37 37 37 21 19 25
19 2[25 25 25 35[42 42 2[{TeXBase1Encoding ReEncodeFont}70
74.7198 /Times-Roman rf /Fn 135[55 78 55 1[33 55 39 1[61
61 61 89 28 2[28 1[61 1[55 61 55 1[55 13[66 2[66 2[83
61 2[28 72 2[66 72 72 72 72 8[55 1[55 1[55 55 55 55 49[{
TeXBase1Encoding ReEncodeFont}34 99.6264 /Helvetica-Bold
rf /Fo 87[28 49[42 42 23 32 28 1[42 42 42 1[23 42 1[23
42 2[37 42 37 1[37 10[60 60 7[74 51 60 32 74[{
TeXBase1Encoding ReEncodeFont}23 83.022 /Times-Roman
rf /Fp 135[66 2[73 1[66 47 2[73 73 1[33 3[73 2[66 73
66 1[66 12[73 80 2[80 1[86 100 73 19[66 1[66 1[66 4[33
47[{TeXBase1Encoding ReEncodeFont}22 119.552 /Helvetica-Bold
rf /Fq 104[74 34[23 1[32 2[42 1[60 6[23 37 1[37 42 42
28[60 10[42 7[42 42 3[21 44[{TeXBase1Encoding ReEncodeFont}15
83.022 /Times-Italic rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
letter

%%EndSetup
%%Page: 1 1
1 0 bop 1387 -300 a Fq(\227)20 b(Dr)o(aft)h(of)f(December)g(10,)f(1999)
g(\227)945 22 y Fp(Threads)34 b(on)f(an)h(L4/x86)h(SMP)e(Nuc)n(leus)
1272 204 y Fo(Marcus)20 b(V)7 b(\250)-35 b(olp)415 b(Jochen)19
b(Liedtk)o(e)1593 404 y(Uni)n(v)o(ersit)5 b(\250)-33
b(at)20 b(Karlsruhe)-150 721 y Fn(1)100 b(Motiv)n(ation)-150
888 y Fm(Symmetric)20 b(Multi)g(Processors)h(\(SMPs\))f(are)g(no)n(w)h
(widely)f(used,)i(e)n(v)o(en)f(as)-150 971 y(lo)n(w-end)h(w)o
(orkstations.)31 b(Medium-sized)23 b(serv)o(ers)e(are)g(typically)h
(double-)-150 1054 y(processor)39 b(or)e(quad-processor)j(systems.)80
b(Consequently)-5 b(,)44 b(an)38 b(SMP-)-150 1137 y(capable)16
b(Nucleus)g(is)f(a)h Fl(conditio)g(sine)f(qua)i(non)f
Fm(for)f(research)h(on)g(L4-based)-150 1220 y(w)o(orkstation)k
(systems.)-67 1307 y(There)g(are)g(four)g(ob)o(vious)h(principles)f
(that)g(ha)o(v)o(e)g(to)g(lead)g(the)g(design)h(of)-150
1391 y(an)i(L4)f(SMP-Nucleus.)33 b(The)22 b(\002rst)f(tw)o(o)i
(principles,)g Fl(compatibility)f(of)g(e)o(x-)-150 1474
y(tension)j Fm(and)h Fl(minimality)e(of)g(e)o(xtension)p
Fm(,)j(go)o(v)o(ern)e(the)g(relations)g(between)-150
1557 y(the)h(e)o(xisting)g(uniprocessor)h(Nucleus)g(and)f(the)g(SMP)f
(Nucleus.)44 b Fl(P)-6 b(erfor)o(-)-150 1640 y(mance)26
b Fm(and)f Fl(\003e)o(xibility/g)o(ener)o(ality)g Fm(are)g(a)f
(perpetuation)i(of)f(e)o(xisting)g(and)-150 1723 y(pro)o(v)n(ably)20
b(successful)g(fundamental)g(L4)f(design)h(principles.)-150
1952 y Fk(1.1)83 b(Goals)-150 2093 y Fm(So)19 b(the)g(goals)g(were)g
(clear)g(from)g(the)g(be)o(ginning:)-82 2254 y(1.)42
b Fl(Compatibility:)28 b Fm(An)o(y)607 2222 y Fj(1)658
2254 y Fm(e)o(xisting)22 b(L4)f(application)i(or)e(L4-based)i(OS)16
2337 y(personality)30 b(should)g(run)f(on)g(top)g(of)g(the)g(SMP)f
(Nucleus)i(without)16 2420 y(modi\002cation.)j(In)22
b(particular)m(,)h(all)e(e)o(xisting)h(Nucleus)h(calls)f(ha)o(v)o(e)g
(to)16 2503 y(k)o(eep)e(their)f(functionality)g(\(and)h(their)e(binary)
i(interf)o(ace\).)-82 2669 y(2.)42 b Fl(T)l(r)o(anspar)m(ency)17
b(in)e(the)f(Lar)m(g)o(e:)23 b Fm(It)14 b(should)i(be)f(easily)g
(possible)g(to)g(con-)16 2752 y(struct)k(applications/systems)i(such)f
(that)f(the)g(w)o(ay)h(ho)n(w)g(the)f(respec-)16 2835
y(ti)n(v)o(e)25 b(threads)g(are)g(distrib)o(uted)g(o)o(v)o(er)g(the)f
(processors)i(has)g(no)f(ef)n(fect)16 2918 y(on)19 b(the)g
(application')l(s/system')l(s)h(functionality)-5 b(.)-82
3083 y(3.)42 b Fl(T)l(r)o(anspar)m(ency)22 b(in)d(the)h(Small:)25
b Fm(In)19 b(principle,)h(no)h(thread)f(should)h(see)16
3166 y(a)h(functional)g(dif)n(ference)h(whether)f(its)f(partner)h
(threads)g(run)g(on)h(the)16 3249 y(same)c(processor)h(or)f(on)h(a)e
(dif)n(ferent)i(one.)-82 3415 y(4.)42 b Fl(Fle)o(xibility/Gener)o
(ality:)62 b Fm(An)o(y)39 b(reasonable)h(multiprocessor)g(OS)16
3498 y(polic)o(y)24 b(should)h(be)e(implementable)i(based)f(on)g(the)g
(SMP)e(Nucleus.)16 3581 y(The)k(SMP)g(Nucleus)h(mechanisms)g(for)f
(scheduling,)k(partitioning,)16 3664 y(and)18 b(distrib)o(ution)g(of)f
(processors,)i(time,)e(and)h(memory)g(must)g(enable)16
3747 y(an)h(as-wide-as-possible)h(design)g(space)g(for)f(policies,)g
(in)g(particular)16 3830 y(for)g(SMP-speci\002c)f(policies.)-82
3995 y(5.)42 b Fl(Non-T)l(r)o(anspar)m(ency:)29 b Fm(SMP-a)o(w)o(are)21
b(systems,)g(e.g.)g(OS)f(schedulers,)16 4078 y(need)h(full)e(access)i
(to)e(SMP-speci\002c)h(system)g(data.)26 b(As)19 b(well,)h(SMP-)16
4161 y(speci\002c)c(hardw)o(are)h(must)g(be)f(usable)h(by)f(such)h
(systems)g(as)f(liberal)g(as)16 4245 y(possible.)23 b(The)15
b(ultimate)g(goal)h(is)f(to)h(support)g(ef)n(\002cient)f(implementa-)16
4328 y(tion)k(of)g(as)g(man)o(y)h(as)f(possible)h(dif)n(ferent)f
(policies)h(and)f(higher)o(-le)n(v)o(el)16 4411 y(mechanisms)h(based)g
(on)f(the)g(SMP-Nucleus)g(primiti)n(v)o(es.)-82 4576
y(6.)42 b Fl(Compatibility)30 b(in)f(P)-6 b(erformance:)46
b Fm(A)30 b(uniprocessor)o(-tar)o(geted)h(ap-)16 4659
y(plication/system)e(running)h(on)g(only)f(one)h(processor)g(of)e(an)h
(SMP)16 4742 y(should)d Fl(cum)f(gr)o(ano)h(salis)e Fm(perform)i(as)f
(if)f(the)h(application/system)16 4825 y(runs)18 b(on)g(a)f(physical)h
(uniprocessor)h(system)e(pro)o(vided)i(memory-b)o(us)16
4908 y(contention)h(is)f(ne)o(gligible.)-82 5074 y(7.)42
b Fl(SMP)56 b(P)-6 b(erformance:)98 b Fm(SMP-speci\002c)55
b(Nucleus)i(mechanisms)16 5157 y(should)20 b(perform)f(as)g(good)h(as)f
(possible.)p -150 5242 901 4 v -60 5298 a Fj(1)-30 5321
y Fi(Pro)o(vided)38 b(the)g(application/OS)j(personality)e(does)f
(neither)h(rely)e(on)g(dis-)-150 5400 y(able/enable)21
b(interrupt)e(for)e(synchronization)k(nor)c(on)g(priority-based)k
(tricks.)2049 721 y Fk(1.2)83 b(T)-7 b(ar)o(g)q(ets)2049
870 y Fm(First)40 b(tar)o(get)h(for)g(a)h(SMP-Nucleus)f(implementation)
h(are)g(x86-based)2049 953 y(SMPs,)20 b(in)h(particular)g(Pentium)f(II)
h(and)g(III)f(based)i(double-processor)h(and)2049 1036
y(quad-processor)d(systems.)j(Such)18 b(systems)g(consist)g(of)g(2)f
(or)h(4)g(processors,)2049 1119 y(each)24 b(supplemented)i(by)e(a)g
(processor)o(-local)h(L1)e(and)i(L2)e(cache,)j(a)d(com-)2049
1202 y(mon)f(DRAM)g(memory)-5 b(,)22 b(an)g(I/O)f(space)h(shared)h
(between)f(all)f(processors,)2049 1285 y(and)f(an)f(APIC-based)g(inter)
o(-processor)g(interrupt)g(netw)o(ork.)2049 1564 y Fn(2)100
b(Principle)28 b(Design)f(Decisions)2049 1740 y Fm(Making)j(a)e(small)g
(Nucleus)h(or)g Fh(\026)p Fm(-k)o(ernel)g(multiprocessor)g(capable)h
(is)e(a)2049 1823 y(relati)n(v)o(ely)h(limited)g(problem.)54
b(In)30 b(the)f(L4)g(Nucleus,)j(we)d(see)g(only)h(fe)n(w)2049
1906 y(global)20 b(k)o(ernel)g(tables,)e(i.e.,)g(such)i(that)f(do)h
(not)f(e)o(xist)g(per)g(processor)h(or)g(per)2049 1989
y(thread)28 b(and)g(that)f(in\003uence)i(the)e(global)h(system,)i
(i.e.,)e(potentially)g(each)2049 2072 y(thread')l(s)i(beha)o(vior)l(.)
54 b(Basically)-5 b(,)32 b(only)e(mapping)g(data)g(\(including)g(page)
2049 2155 y(tables\))d(and)h(the)f(coarse-grain)h(w)o(ak)o(eup)h
(queues)f(are)f(of)g(such)h(type)f(and)2049 2238 y(ha)o(v)o(e)19
b(to)g(be)g(secured)h(for)f(cross-processor)h(access)g(in)f(general.)
2132 2330 y(Thread)45 b(control)g(blocks)h(\(tcbs\))f(require)g
(similar)f(general)i(cross-)2049 2413 y(processor)29
b(access)g(synchronization)i(only)d(if)g(we)g(decide)h(to)g(ha)o(v)o(e)
f(\002ne-)2049 2496 y(grain)20 b(inter)o(-processor)h(scheduling)g(of)g
(threads.)27 b(In)20 b(that)g(case,)g(we)g(w)o(ould)2049
2579 y(ha)o(v)o(e)36 b(to)g(e)o(xplicitly)g(synchronize)i(e)n(v)o(ery)f
(dispatch/scheduling)h(access)2049 2662 y(to)32 b(a)g(tcb,)j(e)n(v)o
(en)e(to)f(the)g(just)f(current)i(tcb)m(.)62 b(Otherwise,)35
b(per)o(-processor)2049 2745 y(dispatch/scheduling)f(data)e(structures)
h(and)f(some)h(ipc)f(tricks)g(\(see)g(be-)2049 2828 y(lo)n(w\))h(w)o
(ould)g(enable)h(us)f(to)g(manage)h(tcbs)f(such)h(that)e
(cross-processor)2049 2911 y(access)k(can)g(be)g(restricted)f(to)g(v)o
(ery)h(special)g(cases:)57 b(basically)36 b(cross-)2049
2994 y(processor)d(ipc,)h(e)o(xplicit)e(migration)g(to)f(a)h(ne)n(w)g
(processor)m(,)j(and)e(cross-)2049 3077 y(processor)24
b(tcb)f(accesses)h(through)h(the)e(Nucleus)h(calls)f
Fg(lthread)p 3781 3077 23 4 v 24 w(e)n(x)p 3882 3077
V 27 w(regs)2049 3160 y Fm(and)g Fg(thread)p 2397 3160
V 25 w(schedule)p Fm(.)32 b(None)23 b(of)g(those)g(operations)h(\226)f
(remember)g(that)2049 3243 y(we)j(listed)h(only)g(cross-processor)h
(operations)g(\226)e(seem)h(to)g(be)g(\002rst-class)2049
3326 y(time)19 b(critical.)2049 3580 y Fk(2.1)83 b(Pr)n(ocessor)n(-Sc)o
(heduling)25 b(Gran)o(ularity)2049 3729 y Fm(So)19 b(the)g(\002rst)f
(design)h(decision)h(has)f(to)g(be)g(about)h(scheduling)g(granularity)
-5 b(.)2132 3821 y(Old-f)o(ashioned)42 b(SMPs)d(with)h(little)f(cache)i
(memory)g(permitted)f(to)2049 3904 y(transfer)27 b(a)g(thread)h(ine)o
(xpensi)n(vly)g(to)f(another)h(processor)l(.)49 b(T)-6
b(oday')l(s)28 b(sys-)2049 3987 y(tems)16 b(with)g(lar)o(ge,)g
(multi-le)n(v)o(el)g(caches)h(and)g(e)o(xtremenly)g(high)g(cache-miss)
2049 4070 y(costs)23 b(increased)g(transfer)g(costs)f
Fl(for)h(running)h(thr)m(eads)f Fm(dramaticlly)-5 b(.)34
b(F)o(or)2049 4153 y(e)o(xample,)24 b(a)e(thread)h(currently)g(using)h
(50)f(cache)g(lines)f(read-only)i(and)f(50)2049 4236
y(cache)16 b(lines)f(read-write)g(requires)h(10\22620)g
Fh(\026)p Fm(s)f(on)h(a)f(500)h(MHz)g(Pentium)f(III,)2049
4319 y(i.e.)39 b(5,000\22610,000)27 b(c)o(ycles.)40 b(Note)25
b(that)f(this)g(is)g(only)h(the)g(time)f(required)2049
4402 y(to)e(transfer)g(the)g(dirty)f(\(minimum)h(time\))g(or)g(all)f
(\(maximum)i(time\))e(cache)2049 4485 y(lines)e(from)g(one)h(L2)f
(cache)h(via)f(the)g(memory)h(b)o(us)f(to)g(the)g(other)g(L2)g(cache.)
2049 4568 y(Since)25 b(b)o(us)h(load)g(is)f(typically)h(v)o(ery)g(high)
h(in)e(a)h(quad-processor)i(system,)2049 4651 y(the)21
b(ef)n(fecti)n(v)o(e)g(costs)g(could)g(double,)h(i.e.)e(might)g
(increase)i(to)e(up)h(to)g(40)g Fh(\026)p Fm(s,)2049
4734 y(because)g(the)e(b)o(us)g(is)g(not)h(a)o(v)n(ailable)g(for)f(the)
g(other)h(three)3544 4702 y Fj(2)3592 4734 y Fm(processors)h(dur)o(-)
2049 4817 y(ing)26 b(this)f(time.)43 b(This)25 b(analysis)i(is,)f
(e.g.,)h(corroborated)g(by)f(Kitche)n(w)o(an')l(s)2049
4900 y(\(no)n(w)19 b(K42')l(s\))g(analysis)h(and)f(e)o(xperiences.)2132
4992 y(Concluding,)33 b(it)28 b(seems)i(unreasonable)h(to)d(e)o(x)o
(ecute)i(thread)g(transfers)2049 5075 y(more)19 b(often)g(than)h(one)f
(per)g(200)h Fh(\026)p Fm(s)f(on)h(a)o(v)o(erage.)j(This)c(leads)g(to)p
2049 5163 901 4 v 2139 5219 a Fj(2)2169 5242 y Fi(The)j(destination)k
(processor)d(requests)h(those)g(cache)g(lines,)h(i.e.)d(will)h(not)g
(run)2049 5321 y(another)k(thread)f(during)g(this)f(acti)n(vity)l(.)47
b(Ho)n(we)n(v)o(er)m(,)28 b(the)e(source)g(processor)f(is)g(not)2049
5400 y(acti)n(v)o(ely)20 b(en)m(v)o(olv)o(ed,)f(and)e(can)h(thus)g(run)
f(another)h(thread.)p eop
%%Page: 2 2
2 1 bop 1387 -300 a Fq(\227)20 b(Dr)o(aft)h(of)f(December)g(10,)f(1999)
g(\227)-64 -67 y Ff(\017)42 b Fe(Design)f(decision)g(1:)68
b Fl(F)m(ine-gr)o(ain)41 b(dispatc)o(hing)i(and)f(sc)o(hedul-)16
16 y(ing)30 b(will)f(not)i(implicitly)e(tr)o(ansfer)h(thr)m(eads)h(to)f
(other)h(pr)m(ocessor)o(s.)16 99 y(Thr)m(ead)20 b(tr)o(ansfer)f(has)g
(always)h(to)f(be)g(initiated)g(by)g(a)g(Nucleus)g(call.)-150
269 y Fm(Conclusions)h(from)f(design)h(decision)g(1:)-82
421 y(1.)42 b(Ready-list)23 b(and)g(short-w)o(ak)o(eup)i(queue)f(e)o
(xist)f(per)g(processor)l(.)36 b(Dis-)16 504 y(patching)20
b(and)g(\002ne-grain)f(scheduling)h(w)o(orks)g(processor)o(-locally)-5
b(.)-82 658 y(2.)42 b(The)26 b(Nucleus)g(call)g Fd(thread)p
752 658 23 4 v 28 w(switch)f Fm(operates)i(processor)o(-local.)45
b(In)16 741 y(particular)m(,)32 b(switching)e(to)g(a)f(thread)h(that)g
(currently)g(resides)g(on)g(a)16 824 y(dif)n(ferent)17
b(processor)i(w)o(orks)e(lik)o(e)h(an)f(unspeci\002c)h
Fd(thread)p 1516 824 V 27 w(switch)f Fm(op-)16 907 y(eration.)-82
1060 y(3.)42 b(A)18 b(nucleus)h(call)f(is)f(needed)j(for)e(thread)g
(transfer)l(.)23 b(Of)17 b(course,)i(access)16 1143 y(to)26
b(that)f(operation)i(has)f(to)f(be)h(someho)n(w)h(protected.)44
b(An)25 b(ob)o(vious)16 1226 y(w)o(ay)d(to)f(do)h(so)g(is)f(to)g(use)h
(the)g(same)f(mechanism)i(that)e(already)h(con-)16 1309
y(trols)g(other)h(scheduling)h(parameters)f(such)h(as)e(priority)h(and)
g(times-)16 1392 y(lice.)16 1475 y(Therefore)31 b(we)g(e)o(xtended)i
(the)e(Nucleus)h(call)e Fd(thread)p 1485 1475 V 28 w(schedule)i
Fm(is)16 1558 y(e)o(xtended)g(by)g(another)f(parameter)m(,)j(the)d
(processor)h(number)l(.)60 b(By)16 1641 y(changing)22
b(this)f(parameter)m(,)g(a)g(user)o(-le)n(v)o(el)g(scheduler)h(can)f(e)
o(xplicitly)16 1724 y(transfer)e(a)g(thread)g(to)g(another)h(processor)
l(.)-150 1938 y Fk(2.2)83 b(Thread)23 b(Mobility)g(at)g(the)g(Nuc)n
(leus)g(Le)o(vel)-150 2073 y Fm(Mobility)f(is)g(a)f(thread')l(s)h
(ability)g(to)g(transfer)f(or)h(being)h(transferred)f(to)g(an-)-150
2156 y(other)d(processor)l(.)-67 2240 y(The)28 b(Nucleus)h(has)g(to)f
(of)n(fer)g(an)h(operation)g(that)g(e)o(xplicitly)f(transfers)-150
2323 y(a)h(thread)g(to)g(another)g(processor)l(.)54 b(Such)29
b(an)g(operation)h(is)e(required)i(for)-150 2406 y(higher)o(-le)n(v)o
(el)c(\(user)o(-le)n(v)o(el\))f(serv)o(ers)h(that)f(implement)h
(arbitrary)g(schedul-)-150 2489 y(ing)d(policies.)34
b(W)-6 b(e)21 b(e)o(xtended)j(the)f(Nucleus)g(call)f
Fd(thread)p 1364 2489 V 28 w(schedule)h Fm(as)g(de-)-150
2572 y(scribed)c(in)g(conclusion)i(3)e(to)g(do)g(this.)-67
2656 y(Implicit)h(thread)h(transfers)f(on)h(the)f(Nucleus)h(le)n(v)o
(el)g(through)g(\002ne-grain)-150 2739 y(Nucleus)33 b(scheduling)h
(were)e(already)h(rejected)f(by)h(design)g(decision)g(1.)-150
2822 y(T)-6 b(w)o(o)21 b(potential)g(opportunities)h(for)f(Nucleus-le)n
(v)o(el)h(mobility)f(remain:)27 b(\(a\))-150 2905 y(restricted)g(e)o
(xplicit)g(thread)h(transfer)f(without)g(contacting)h(a)f(scheduling)
-150 2988 y(serv)o(er)m(,)19 b(and)g(\(b\))g(implicit)f(mobility)h(on)h
(IPC.)-67 3072 y(\(a\))25 b(A)f(scenario)i(might)f(include)g(that)g(a)g
(scheduler)h(can)f(specify)g(a)g(set)-150 3155 y(of)g(directly)g
(accessable)h(processors)f(for)g(a)g(thread)g(such)h(that)e(the)h
(thread)-150 3239 y(could)18 b(then)f(transfer)f(itself)g(to)h(an)o(y)g
(of)g(those)g(processors.)24 b(Ho)n(we)n(v)o(er)m(,)17
b(since)-150 3322 y(the)27 b(costs)g(of)g(transferring)g(a)g(thread)g
(to)g(a)g(dif)n(ferent)g(processor)h(are)f(1\2262)-150
3405 y(orders)18 b(of)g(magnitude)h(higher)g(than)f(a)g(short)g
(intra-processor)h(ipc,)f(there)g(is)-150 3488 y(no)f(reason)h(to)f
(add)g(such)h(a)f(feature)g(to)g(the)g(Nucleus.)23 b(It)16
b(is)g(al)o(w)o(ays)i(feasible,)-150 3571 y(e)n(v)o(en)h(preferrable)g
(from)g(a)f(polic)o(y)h(point)g(of)f(vie)n(w)-5 b(,)19
b(to)f(contact)h(a)g(user)o(-le)n(v)o(el)-150 3654 y(scheduler)h
(through)g(ipc.)-67 3738 y(\(b\))k(Mobility)g(on)h(cross-processor)g
(ipc)f(is)g(a)g(slightly)g(dif)n(ferent)g(prob-)-150
3821 y(lem.)43 b(Firstly)-5 b(,)26 b(cross-address-space)h(ipc)f(is)f
(itself)f(an)i(e)o(xpensi)n(v)o(e)h(opera-)-150 3904
y(tion)22 b(\226)g(although)h(probably)g(cheaper)g(than)f(a)g(thread)g
(transfer)l(.)32 b(Secondly)-5 b(,)-150 3987 y(transferring)20
b(the)g(sender)h(or)f(recei)n(v)o(er)h(to)f(the)g(processor)h(of)f(its)
f(respecti)n(v)o(e)-150 4070 y(partner)h(can)f(ha)o(v)o(e)h(v)o(ery)f
(positi)n(v)o(e)h(ef)n(fects)f(if)g(either)g(\(i\))f(both)i(partners)g
(will)-150 4153 y(communicate)h(hea)o(vily)f(through)h(ipc)f(in)f(the)h
(near)g(future)g(or)f(\(ii\))g(both)h(use)-150 4236 y(a)f(lar)o(ge)g
(amount)g(of)g(shared)h(data)f(subsequently)i(to)e(the)g(ipc.)-67
4320 y(Implicit)d(mobility)h(on)h(ipc)f(w)o(ould)h(enable)g(schedulers)
g(to)f(specify)-5 b(,)17 b(e.g.,)-150 4403 y(that)28
b(a)h(certain)g(thread,)i(sender)e(or)g(recei)n(v)o(er)m(,)i(should)e
(be)g(automaticllay)-150 4486 y(transferred)e(to)g(the)g(respecti)n(v)o
(e)h(partner')l(s)f(processor)h(on)f(ipc.)47 b(A)27 b(serv)o(er)-150
4569 y(thread)20 b(with)f(the)g(mobile-on-recei)n(v)o(e)i(option)f(w)o
(ould)g(then)f(automatically)-150 4652 y(run)j(on)f(its)g(clients)g
(processor)l(.)32 b(W)m(ith)20 b(mobile-on-send,)k(the)d(same)h(serv)o
(er)-150 4735 y(thread)c(w)o(ould)h(instead)f(al)o(w)o(ays)h(mo)o(v)o
(e)f(to)f(its)h(last)f(client')l(s)g(processor)i(after)-150
4818 y(e)o(x)o(ecuting)k(its)f(\002rst)f(request.)34
b(The)22 b(ne)o(xt)h(idea)f(is)g(ob)o(vious:)31 b(you)23
b(probably)-150 4901 y(w)o(ant)e(the)f(serv)o(er)h(thread)g(to)f
(decide)i(on)f(a)f(case-by-case)i(basis)f(whether)f(it)-150
4984 y(should)g(transfer)f(or)g(not,)g(etc.)-67 5068
y(This)31 b(illustrates)h(clearly)g(that)f(mobility)h(on)h(ipc)e(is)h
(a)g Fl(policy)l(,)j Fm(not)d(a)-150 5151 y Fl(mec)o(hanism.)d
Fm(The)21 b(sk)o(etched)h(\223mobile-on-send/recei)n(v)o(e\224)h
(primiti)n(v)o(es)e(are)-150 5234 y(insuf)n(\002cient.)34
b(An)o(y)23 b(such)g(mechanism)h(w)o(ould)f(probably)h(include)g
(unnec-)-150 5317 y(essary)18 b(polic)o(y)f(in)g(the)g(Nucleus,)h
(i.e.,)e(w)o(ould)i(thus)f(be)h(too)f(restricti)n(v)o(e.)22
b(Per)o(-)-150 5400 y(formance)28 b(ar)o(guments)g(corroborate)h(to)e
(drop)i(implict)e(mobility)g(on)h(ipc:)2049 -67 y(Rpc)18
b(to)g(a)g(user)o(-le)n(v)o(el)g(scheduler)h(follo)n(wed)g(by)f(an)h(e)
o(xplict)f(scheduling)h(op-)2049 16 y(eration)h(is)g(al)o(w)o(ays)g(ne)
o(gligible)h(compared)g(to)f(the)g(implicit)f(o)o(v)o(erhead)i(of)f(a)
2049 99 y(thread)e(transfer)l(.)k(Thus)17 b(arbitrary)g
(mobility-on-ipc)h(polic)o(y)g(can)f(be)h(imple-)2049
182 y(mented)g(outside)h(the)f(Nucleus)g(pro)o(vided)h(user)o(-le)n(v)o
(el)f(softw)o(are)f(can)i(easily)2049 265 y(and)h(ine)o(xpensi)n(v)o
(ely)g Fl(detect)f(cr)m(oss-pr)m(ocessor)i(ipc.)2135
456 y Ff(\017)42 b Fe(Design)19 b(decision)h(2:)25 b
Fl(The)19 b(Nucleus)h(will)f(not)h(of)o(fer)f(implicit)g(mobil-)2215
539 y(ity)g(on)h(ipc.)26 b(Instead,)20 b(the)g(Nucleus)g(will)f
(support)h(c)o(heap)h(and)g(easily)2215 622 y(usable)f(mec)o(hanisms)g
(to)e(detect)i(cr)m(oss-pr)m(ocessor)g(ipc.)2049 813
y Fm(Basically)-5 b(,)43 b(there)38 b(are)g(tw)o(o)h(dif)n(ferent)f(w)o
(ays)h(for)f(detection)h(of)g(cross-)2049 896 y(processor)22
b(ipc:)27 b(either)21 b(\(a\))g(ipc)g(informs)g(the)g(in)m(v)o(ok)o(er)
h(about)f(its)g(partner')l(s)2049 979 y(processor)m(,)34
b(or)d(\(b\))f(ipc)h(can)g(be)g(parametrized)h(such)f(that)f(it)g(f)o
(ails)h(on)g(a)2049 1062 y(cross-processor)26 b(ipc.)40
b(Conceptually)-5 b(,)26 b(\(a\))f(is)f(a)g(trap,)h(i.e.)f(signals)h
(cross-)2049 1145 y(processor)30 b(ipc)f Fl(after)g Fm(it)f(completed,)
k(while)d(\(b\))g(is)f(a)h(f)o(ault,)i(i.e.)d(signals)2049
1228 y Fl(befor)m(e)20 b Fm(ipc)f(is)f(e)o(x)o(ecuted.)2132
1318 y(Mechanism)f(\(a\),)e(e)o(xtending)h(ipc)g(such)f(that)g(it)g
(reports)g(cross-processor)2049 1401 y(ipc)k(after)g(completion,)g(is)g
(good)h(for)f(e)o(xperimental)h(purposes)g(\(e)n(v)o(en)g(ideal)2049
1484 y(for)f(serv)o(er)h(threads)f(that)g(try)h(to)f(adopt)h
(dynamically)g(to)f(clients\))g(and)h(easy)2049 1567
y(to)14 b(implement.)22 b(Its)14 b(only)i(disadv)n(antage)g(seems)f(to)
f(be)h(that)f(in)h(some)g(cases)g(a)2049 1650 y(cross-processor)20
b(ipc)e(might)g(be)h(detected)g(only)f(after)g(it)g(happened.)25
b(Ho)n(w-)2049 1733 y(e)n(v)o(er)m(,)i(currently)f(the)g(authors)g(are)
g(not)g(a)o(w)o(are)g(of)f(a)h(scenario)g(where)g(this)2049
1816 y(delayed)20 b(detection)g(could)f(mak)o(e)h(a)f(dif)n(ference.)
2132 1905 y(Mechanism)28 b(\(b\))f(w)o(ould)h(signal)f(cross-processor)
i(ipc)e(before)g(it)g(w)o(as)2049 1988 y(e)o(x)o(ecuted.)52
b(Ho)n(we)n(v)o(er)m(,)31 b(puristically)-5 b(,)30 b(it)d(could)i(w)o
(ork)g(only)g(on)f(send/call)2049 2071 y(operations;)20
b(applied)f(to)g(recei)n(v)o(e)h(operations,)f(it)f(de)o(generates)j
(to)e(\(a\).)2132 2161 y(In)c(f)o(act,)h(the)g(dif)n(ferences)g
(between)g(both)g(possibilities)f(seem)g(to)h(be)f(ne)o(g-)2049
2244 y(ligible)h(for)h(an)f(e)o(xperimental)i(Nucleus.)k(F)o(or)16
b(the)h(time)f(being,)h(we)g(decided)2049 2327 y(to)i(implement)h
(\(a\),)e(see)i(Section)f(4.2,)g(since)h(on)f(the)h(current)f(x86)h(v)o
(ersion,)2049 2410 y(the)25 b(small)g(number)h(of)g(a)o(v)n(ailable)f
(re)o(gisters)g(let)g(us)g(prefer)h(an)f(additional)2049
2493 y(output)20 b(parameter)f(instead)g(of)g(another)h(input)f
(parameter)l(.)2049 2733 y Fk(2.3)83 b(Co)n(ver)r(t)23
b(Channels)2049 2878 y Fm(Clearly)-5 b(,)16 b(an)o(y)h(method)h(of)e
(detecting)h(on)g(which)g(processor)g(another)g(thread)2049
2961 y(or)31 b(e)n(v)o(en)h(the)f(current)h(is)f(running)h(could)g(be)g
(used)f(for)h(a)f(co)o(v)o(ert)g(chan-)2049 3044 y(nel.)39
b(The)24 b(abo)o(v)o(e)h(discussed)g(Nucleus)g(features)f(for)g
(detection)h(of)f(cross-)2049 3127 y(processor)18 b(ipc)g(are)f(the)h
(\002rst)e(SMP-speci\002c)h(methods)h(inside)g(the)f(Nucleus)2049
3210 y(that)25 b(inherently)h(of)n(fer)f(co)o(v)o(ert)g(channels.)43
b(Besides)26 b(cross-processor)o(-ipc)2049 3293 y(detection,)36
b(processor)o(-number)f(information)e(could)h(only)f(be)g(recei)n(v)o
(ed)2049 3376 y(through)40 b(a)e(user)o(-le)n(v)o(el)g(scheduler)l(.)83
b(So)38 b(co)o(v)o(er)o(-channel-free)i(policies)2049
3459 y(could)20 b(ha)o(v)o(e)f(been)h(implemented.)2132
3548 y(No)n(w)-5 b(,)47 b(in)41 b(the)g(presence)h(of)g(Nucleus-based)g
(detection)g(of)g(cross-)2049 3631 y(processor)20 b(ipc,)f(the)g(ne)n
(w)g(co)o(v)o(er)g(channel)h(can)g(no)f(longer)h(be)f(controlled.)2132
3721 y(W)-6 b(e)31 b(ha)o(v)o(e)g(slightly)g(decreased)h(the)g(channel)
g(by)f(not)h(deli)n(v)o(ering)g(the)2049 3804 y(processor)e(number)f(b)
o(ut)g(only)g(dif)n(ferentiate)g(between)g(\223my)h(processor\224)2049
3887 y(and)21 b(\223another)h(processor\224.)30 b(Ho)n(we)n(v)o(er)m(,)
22 b(the)e(security)h(ef)n(fect)g(is)g(still)e(ques-)2049
3970 y(tionable.)43 b(Finally)-5 b(,)26 b(e)n(v)o(en)h(without)e
(Nucleus-based)i(detection)f(of)g(cross-)2049 4053 y(processor)e(ipc,)h
(an)o(yone)f(could)h(easily)e(\002nd)g(out)h(whether)g(its)e(partner)i
(re-)2049 4136 y(sides)30 b(on)g(the)g(same)g(processor)h(or)e(not)h
(until)g(it)f(can)h(read)g(a)f(\002ne-grain)2049 4219
y(clock.)2132 4308 y(Fundamentally)-5 b(,)28 b(the)e(non-transparenc)o
(y)i(goal)e(5)f(contradicts)h(the)g(re-)2049 4391 y(quest)e(to)g
(disable)g(co)o(v)o(ert)g(channels.)38 b(This)24 b(questions)g(remains)
g(open)h(for)2049 4474 y(discussion.)2132 4564 y(Assuming)j(that)f(we)g
(w)o(ould)h(later)e(conclude)j(that)e(we)g(ha)o(v)o(e)g(to)g(a)o(v)o
(oid)2049 4647 y(Nucleus-based)j(detection)g(of)f(cross-processor)h
(ipc,)h(we)d(could)i(switch)2049 4730 y(to)23 b(implicit)g
(mobility-on-recei)n(v)o(e)h(as)f(an)h(option.)37 b(\(Most)23
b(threads)h(w)o(ould)2049 4813 y(run)f(in)f(a)g(no-mobility)h(mode.\))
35 b(Processor)o(-number)23 b(information)g(w)o(ould)2049
4896 y(then)j(no)f(longer)h(be)g(a)o(v)n(ailable)f(through)i(the)e
(Nucleus)h(pro)o(vided)g(that)f(no)2049 4979 y(clocks)d(were)g
(readable.)31 b(An)22 b(alternati)n(v)o(e)f(solution)i(w)o(ould)f(be)g
(to)f(drop)h(all)2049 5062 y(such)h(mechanisms)g(and)f(use)h(the)f
(projected)h(V)-8 b(ersion)22 b(5)g(mechanisms)h(for)2049
5145 y(mapping)d(threads.)2132 5234 y(Since)h(the)g(absence)h(of)f
(clock-related)g(co)o(v)o(ert)g(channels)h(seems)g(to)e(un-)2049
5317 y(realistic)f(for)g(the)h(near)f(future)h(and)g(since)g(V)-8
b(ersion)19 b(5)h(is)f(not)g(yet)h(a)o(v)n(ailable,)2049
5400 y(we)f(decide:)1931 5700 y(2)p eop
%%Page: 3 3
3 2 bop 1387 -300 a Fq(\227)20 b(Dr)o(aft)h(of)f(December)g(10,)f(1999)
g(\227)-64 -67 y Ff(\017)42 b Fe(Design)18 b(decision)g(2a:)24
b Fl(F)-8 b(or)18 b(the)g(time)g(being)o(,)h(co)o(vert-c)o(hannel)h(pr)
m(ob-)16 16 y(lems)25 b(ar)m(e)h(ignor)m(ed.)45 b(As)25
b(soon)h(as)g(\(1\))f(we)h(have)g(enough)h(pr)o(actical)16
99 y(e)o(xperiences)h(with)f(SMP)h(applications)h(and)f(\(2\))f(co)o
(vert)h(c)o(hannels)16 182 y(avoidance)21 b(seems)e(possible)o(,)g
(design)h(decision)g(2)f(will)f(be)h(r)m(e)o(visited.)16
265 y(Design)f(decision)g(2)f(will)f(also)h(be)h(r)m(e)o(visited)f(for)
g(Nucleus)h(V)-8 b(er)o(sion)17 b(5.)-150 479 y Fk(2.4)83
b(Cr)n(oss-Pr)n(ocessor)25 b(IPC)-150 615 y Fm(Ipc)36
b(across)g(processor)h(boundaries)h(is)d(basically)i(an)f
(implementation)-150 698 y(problem.)53 b(The)28 b(compatibility)h(goal)
g(1)f(and)h(the)g(transparenc)o(y)h(goals)f(2)-150 781
y(and)20 b(3)f(enforce)g(almost)g(automatically)h(the)f(ne)o(xt)g
(design)h(decision:)-64 951 y Ff(\017)42 b Fe(Design)36
b(decision)h(3:)58 b Fl(Ipc)37 b(works)f(intr)o(a-pr)m(ocessor)i(as)f
(well)f(as)16 1034 y(cr)m(oss-pr)m(ocessor)-8 b(.)57
b(The)29 b(functionality)i(is)e(identical)h(for)g(both)g(\003a-)16
1117 y(vor)o(s.)49 b(Ipc)27 b(can)h(be)f(used)h(tr)o(anspar)m(ently)l
(,)i(i.e)o(.)d(communicating)h(do)16 1200 y(not)g(have)g(to)g(car)m(e)g
(about)h(on)f(whic)o(h)f(r)m(espective)i(pr)m(ocessor)o(s)g(the)n(y)16
1283 y(run.)24 b(Howe)o(ver)-8 b(,)18 b(the)n(y)h(can)h(car)m(e)g
(about)f(that)g(detail)g(\(see)g(abo)o(ve\).)-150 1497
y Fk(2.5)83 b(VM)24 b(Primitives)-150 1633 y Fm(This)h(paper)i(focuses)
g(on)f(threads.)45 b(As)25 b(of)h(our)g(current)h(kno)n(wledge,)i(the)
-150 1716 y(VM)d Fl(interface)f Fm(does)h(not)g(need)g(to)g(be)f(e)o
(xtended)i(for)e(SMPs.)42 b(The)25 b(SMP)-150 1799 y
Fl(implementation)30 b Fm(of)f(VM,)f(ho)n(we)n(v)o(er)m(,)33
b(is)28 b(performance-critical)i(and)g(not)-150 1882
y(tri)n(vial.)45 b(The)27 b(implementation)g(topic)g(will)e(be)i
(discussed)h(in)e(detail)g(in)h(a)-150 1965 y(further)d(paper)l(.)37
b(Whether)24 b(the)g(current)g(VM)f(primiti)n(v)o(es)h(and)g
(abstraction)-150 2048 y(are)29 b(suf)n(\002cient)g(for)g(higher)o(-le)
n(v)o(el)h(VM)f(policies)g(on)h(SMPs,)g(e.g.)f(enable)-150
2131 y(K42')l(s)18 b(split)f(address-space)i(technology)-5
b(,)20 b(will)d(be)g(discussed)i(in)f(the)f(same)-150
2214 y(paper)l(.)-150 2453 y Fn(3)100 b(API)28 b(Extensions)-150
2615 y Fm(SMP-speci\002c)15 b(API)g(e)o(xtensions)i(are)f(described.)23
b(The)16 b(logical)g(description)-150 2698 y(is)23 b(complemented)h(by)
g(the)f(current)g(and)h(pro)o(visional)g(description)g(of)f(the)-150
2781 y(x86)29 b(interf)o(ace.)53 b(Note)28 b(that)h(the)g(x86)g(interf)
o(ace)g(will)f(change)i(when)f(the)-150 2864 y(v)o(ersion)20
b(4)f(and)g(5)g(binary)h(interf)o(aces)f(are)g(de\002ned.)-150
3062 y Fc(ipc)74 b Fm(Output)29 b(parameters)h(are)f(complemented)i(by)
e(a)g Fl(cr)m(oss-pr)m(ocessor)-150 3145 y(\003a)o(g)p
Fm(.)50 b(It)27 b(is)g(set)g(when)h(the)g(last)f(communictation)i(w)o
(as)f(cross)g(processor)-150 3228 y(boundaries,)22 b(reset)f
(otherwise.)28 b(F)o(or)20 b(tw)o(o-phase)h(ipc)g(operations,)g(i.e.)f
Fl(call)-150 3311 y Fm(and)28 b Fl(r)m(eply/wait)p Fm(,)i(\223last)d
(communication\224)i(means)g(the)e(second)i(part;)j(for)-150
3394 y(single-phase)26 b(ipcs,)g(it)e(refers)h(to)g(the)f(\002rst)g
(part.)41 b(Note)25 b(that)f(no)h(ef)n(fecti)n(v)o(e)-150
3477 y(communication,)20 b(i.e.)f(timeouts,)g(cancelations,)g(and)h
(aborts)g(do)f(ne)n(v)o(er)h(set)-150 3560 y(the)15 b(cross-processor)i
(\003ag.)22 b(User)15 b(programs)h(may)g(deliberately)g(ignore)g(the)
-150 3643 y(\003ag.)-150 3727 y Fb(Pr)m(o)o(visional)j(x86)e
(implementation:)-150 3810 y Fi(The)i(cross-processor)i(\003ag)f(is)f
(encoded)j(in)d(the)i(processor')l(s)f(Z-\003ag.)28 b
Fb(Anyone)20 b(who)-150 3893 y(wants)j(to)g(r)n(ead)g(the)g(cr)m
(oss-pr)m(ocessor)h(\003a)o(g)f(after)h(ipc)f(has)f(to)h(set)g(the)h
(pr)m(ocessor')m(s)-150 3976 y(Z-\003a)o(g)19 b(prior)f(to)h(in)m(vok)o
(e)i(the)e(ipc)g(Nucleus)h(call.)25 b Fi(If)18 b(this)h(w)o(as)g(done,)
g(NZ)e(after)j(com-)-150 4059 y(pletion)j(of)e(the)g(Nucleus)h(call)g
(means)f(cross-processor)i(\003ag)e(set,)g(Z)f(means)h(cross-)-150
4142 y(process)d(\003ag)f(reset.)-150 4340 y Fc(thread)p
84 4340 23 4 v 25 w(s)o(witc)o(h)74 b Fm(A)85 b(speci\002c)h
Fd(thread)p 1054 4340 V 28 w(switch)f(\()p Fh(t)p Fd(\))g
Fm(w)o(orks)i(as)-150 4423 y Fd(thread)p 40 4423 V 28
w(switch)35 b(\(0\))g Fm(if)f(the)h(thread)h Fh(t)e Fm(currently)i
(resides)f(on)h(a)f(proces-)-150 4506 y(sor)19 b(dif)n(ferent)g(from)g
(the)g(in)m(v)o(oking)h(thread')l(s)f(processor)l(.)-150
4703 y Fc(thread)p 84 4703 V 25 w(sc)o(hedule)72 b Fm(Input)46
b(and)h(output)f(parameters)g(are)g(comple-)-150 4786
y(mented)20 b(by)f(the)g Fl(pr)m(ocessor)h(number)-8
b(.)-150 4870 y Fb(Pr)m(o)o(visional)19 b(x86)e(implementation:)-150
4953 y Fi(Bits)f(16\22619)g(of)g(the)g Fb(par)o(am)g(wor)n(d)p
Fi(,)f(re)o(gister)j(EAX,)c(are)i(used)g(to)g(encode)h(the)g(proces-)
-150 5036 y(sor)i(number)l(.)29 b(V)-7 b(alid)20 b(processor)h(numbers)
e(are)h(1\22615.)29 b(F)o(or)19 b(compatibility)k(reasons,)-150
5119 y(the)18 b(processor)g(number)f(0)g(means)h(\223in)m(v)n
(alid\224.)-150 5317 y Fc(Clari\002cation)72 b Fm(T)-6
b(ask)27 b(and)h(thread)f(creation)h(is)f(not)g(changed.)50
b(Ne)n(wly)-150 5400 y(created)19 b(threads)h(will)e(initially)g(run)h
(on)h(the)f(creator')l(s)g(processor)l(.)2049 -67 y Fc(K)o(ernel)25
b(Inf)o(o)g(P)n(a)o(g)q(e)73 b Fm(The)24 b(k)o(ernel)h(info)f(no)n(w)g
(also)h(contains)f(the)g(max-)2049 16 y(imum)31 b(processor)g(number)l
(.)58 b(\()p Fh(k)32 b Fm(processors)g(are)e(numbered)i(1)f(to)f
Fh(k)r Fm(,)j(0)2049 99 y(means)20 b(in)m(v)n(alid\))2049
183 y Fb(Pr)m(o)o(visional)f(x86)e(implementation:)2049
266 y Fi(Maximum)24 b(processor)h(number)f(is)f(contained)k(in)d(an)g
(8-bit)g(w)o(ord)h(at)f(relati)n(v)o(e)i(po-)2049 349
y(sition)g(0xB8)f(in)g(the)g(k)o(ernel-info)j(page.)44
b(The)24 b(higher)i(24)f(bits)g(of)f(that)i(w)o(ord)f(are)2049
432 y(reserv)o(ed)19 b(for)e(future)h(use,)f Fa(n)p Fi(-w)o(ay)g(SMPs)f
(and)i(NUMAs.)2049 669 y Fn(4)100 b(Implementation)2049
831 y Fm(A)42 b(fundamental)i(in)m(v)n(ariant)f(for)g(the)f(\002rst)g
(e)o(xperimental)h(V)-8 b(ersion)43 b(of)2049 914 y(L4/SMP)18
b(is)2215 1065 y(Internally)-5 b(,)23 b(thread)f(control)g(blocks)h
(are)f(ne)n(v)o(er)g(written)f(cross)2215 1148 y(processor)34
b(boundaries.)66 b(Thus)33 b(the)g(thread)g(that)f(currently)2215
1231 y(e)o(x)o(ecutes)f(on)f(processor)h Fh(i)e Fm(has)i(complete)f
(control)g(o)o(v)o(er)g(all)2215 1314 y(threads)20 b(that)e(are)h
(currently)h(assigned)g(to)e(processor)i Fh(i)p Fm(.)2049
1466 y(On)27 b(the)f(one)i(hand,)h(the)e(Nucleus)g(can)g(al)o(w)o(ays)g
(directly)g(access)g(threads)2049 1549 y(that)17 b(reside)g(on)g(the)g
(same)g(processor)m(,)h(e.g.)f(for)g(ipc,)g(scheduling,)h(dispatch-)
2049 1632 y(ing,)27 b(and)g(e)o(xchange)g(of)f(thread)g(re)o(gisters.)
43 b(No)25 b(synchronization)j(primi-)2049 1715 y(ti)n(v)o(es)19
b(are)g(required)g(for)g(these)g(v)o(ery)h(frequent)f(cases.)2132
1798 y(On)i(the)g(other)g(hand,)i(accessing)f(a)f(thread)g(that)g
(resides)g(on)h(a)f(dif)n(ferent)2049 1881 y(processor)27
b(requires)g(al)o(w)o(ays)g(to)f(send)h(the)f(access)h(request)g(to)f
(the)g(desti-)2049 1964 y(nation)i(process)g(and)h(e)o(x)o(ecute)f(it)f
(there.)49 b(By)27 b(f)o(ar)h(most)f(cross-processor)2049
2047 y(acti)n(vities,)i(e.g.)e(ipc,)j(e)n(v)o(entually)e(require)g(an)o
(yho)n(w)h(destination)f(proces-)2049 2130 y(sor')l(s)22
b(acti)n(vity)-5 b(.)34 b(\(Remember)22 b(there)h(is)f(no)h(implicit)e
(\002ne-grain)i(processor)2049 2213 y(scheduling.\))38
b(Therefore,)24 b(it)f(is)g(hoped)h(that)g(in)f(total)g(this)g
(mechanism)h(is)2049 2297 y(not)f(only)h(simpler)f(b)o(ut)g(also)g(f)o
(aster)g(than)h(al)o(w)o(ays)f(locking)h(all)f(participat-)2049
2380 y(ing)16 b(data)f(structures.)23 b(\(Remember)m(,)16
b(we)f(e)o(xclude)i(memory)f(mapping)h(from)2049 2463
y(this)i(discussion.\))2049 2675 y Fk(4.1)83 b(Nuc)n(leus)24
b(Pr)n(o)n(xy)f(Threads)2049 2809 y Fm(The)g(Nucleus)g(establishes)g
(on)h(e)n(v)o(ery)f(processor)h(a)f(set)f(of)h Fl(pr)m(oxy)h(thr)m
(eads)2049 2893 y Fm(that)i(are)g(responsible)h(to)f(handle)h(all)e
(cross-processor)j(acti)n(vities.)44 b(Only)2049 2976
y(the)22 b(Nucleus)g(can)g(communicate)h(with)e(those)i(threads.)32
b(From)21 b(user)o(-le)n(v)o(el)2049 3059 y(perspecti)n(v)o(e,)33
b(the)o(y)d(do)g(not)g(e)o(xist.)54 b(Nucleus)31 b(communication)g(to)e
(those)2049 3142 y(threads)21 b(is)g(via)g(per)o(-processor)h(mailbox)o
(es)f(for)g(information)g(interchange)2049 3225 y(and)i(through)h
(inter)o(-processor)f(interrupts)g(to)f(trigger)h(acti)n(vities.)33
b(Incom-)2049 3308 y(ing)19 b(proxy)h(requests)f(are)g(distrib)o(uted)f
(stackwise)h(to)g(the)g(proxy)h(threads)f(of)2049 3391
y(the)k(destination)h(processor)l(.)36 b(So)23 b(the)g(number)i(of)e
(proxies)g(per)h(processor)2049 3474 y(determines)d(ho)n(w)g(man)o(y)h
(long-lasting)f(acti)n(vities,)f(e.g.)g(long)i(ipcs,)e(can)h(be)2049
3557 y(handled)16 b(in)f(parallel.)21 b(One)15 b(proxy)h(is)e(al)o(w)o
(ays)i(reserv)o(ed)f(for)g(short)g(acti)n(vities)2049
3640 y(lik)o(e)k(short)g(ipcs,)g(thread)g(scheduling)i(and)e(e)o
(xchange)i(of)e(thread)g(re)o(gisters.)2132 3723 y(T)-6
b(o)19 b(reduce)i(cross-processor)g(interrupts,)e(e)n(v)o(ery)h
(processor)h(constantly)2049 3806 y(publishes)30 b(when)g(it)e
(approximately)i(will)e(check)i(its)f(mailbox)g(the)g(ne)o(xt)2049
3889 y(time)18 b(and)h(the)g(number)g(of)g(currently)g(acti)n(v)o(e)f
(short)h(and)g(long)g(proxy)h(acti)n(v-)2049 3972 y(ities.)38
b(Cross-processor)25 b(interrupts)g(are)f(then)g(skipped)i(if)d(the)h
(originator)2049 4055 y(could)c(e)o(xpect)f(handling)h(of)f(its)g
(request)g(early)g(enough.)2049 4268 y Fk(4.2)83 b(Ipc)2049
4402 y Fm(If)26 b(destination)g(and)h(source)g(thread)f(reside)h(on)f
(the)g(same)h(processor)g(the)2049 4485 y(Nucleus)22
b(w)o(orks)g(e)o(xactly)g(lik)o(e)g(in)g(the)f(uniprocessor)i(case.)32
b(Otherwise,)21 b(it)2049 4568 y(encodes)27 b(the)g(current)f
(operation)h(and)g(sends)f(it)g(to)g(the)g(destination)h(pro-)2049
4651 y(cessor')l(s)e(mailbox.)42 b(Ev)o(entually)-5 b(,)27
b(a)e(proxy)h(will)e(e)o(x)o(ecute)i(the)f(ipc)g(on)h(the)2049
4734 y(destination)h(processor)m(,)i(i.e.)d(we)g(basically)h(again)g
(ha)o(v)o(e)g(a)f(uniprocessor)2049 4818 y(ipc.)2132
4901 y(While)17 b(the)h(proxy)g(transfers)g(the)g(message,)g(the)g
(source)g(thread)g(is)f(w)o(ait-)2049 4984 y(ing)26 b(for)f(completion)
h(on)g(the)g(source)g(processor)l(.)43 b(The)26 b(thread)g(is)f(lock)o
(ed)2049 5067 y(b)o(ut)19 b(has)g(released)g(the)g(source)h(processor)l
(.)2132 5151 y(It)26 b(is)g(currently)h(open)g(whether)g(such)g(a)f
(mechanism)h(is)f(good)i(or)e(bad)2049 5234 y(from)d(the)h(cache')l(s)g
(point)g(of)f(vie)n(w)-5 b(.)38 b(Although)24 b(reading)g(a)g(long)g
(message)2049 5317 y(on)h(the)f(destination)h(processor)h(will)d
(surely)i(lead)g(to)f(cache)h(read)g(misses)2049 5400
y(and)e(according)h(b)o(us)e(traf)n(\002c,)g(writing)g(the)h(data)f
(allocates)h(cache)g(lines)f(on)1931 5700 y(3)p eop
%%Page: 4 4
4 3 bop 1387 -300 a Fq(\227)20 b(Dr)o(aft)h(of)f(December)g(10,)f(1999)
g(\227)-150 -67 y Fm(the)h(destination)h(processor)l(.)27
b(This)19 b(is)g(a)h(wide)g(\002eld)g(for)f(tricks)h(\(e.g.)g(write-)
-150 16 y(through)g(on)g(source,)f(uncacheable)i(on)e(dest,)g(etc.\))k
(and)c(e)o(xperiments.)-150 226 y Fk(4.3)83 b(Thread)23
b(T)-7 b(ransf)o(er)i(,)24 b(etc.)-150 359 y Fm(Explicit)39
b(thread)g(transfer)g(through)i Fd(thread)p 1080 359
23 4 v 27 w(schedule)g Fm(uses)e(a)g(similar)-150 442
y(scheme:)e(the)25 b(thread)h(is)f(\226)g(potentially)h(through)h(a)e
(proxy)h(request)g(to)f(its)-150 525 y(old)19 b(processor)g(\226)f
(frozen)h(on)g(its)f(old)g(processor)h(and)g(then)g(unfrozen)h(on)e
(its)-150 608 y(ne)n(w)i(processor)l(.)25 b(If)19 b(a)h(destination)g
(thread)g(of)f(an)h(ipc)f(is)g(transferred)h(while)-150
691 y(ipc)k(is)f(still)g(running,)j(ipc)e(is)g(simply)g(restarted)g(by)
g(the)g(source)g(thread)h(of)-150 774 y(the)19 b(ipc)g(operation.)-67
858 y(Cross-processor)26 b(operations)g Fd(lthread)p
986 858 V 28 w(e)o(x)p 1083 858 V 27 w(re)o(gs)f Fm(w)o(ork)h(through)g
(prox-)-150 941 y(ies.)-150 1150 y Fk(4.4)83 b(K)o(ernel)24
b(Data)f(Structures)-150 1284 y Fc(4.4.1)73 b(Read)o(y-list)18
b(and)h(shor)q(t-wakeup)f(queue)-150 1418 y Fm(As)31
b(discribed)g(in)g(the)g(\002rst)e(conclusion)k(of)d(the)h(\002rst)f
(design)i(principle,)-150 1501 y(each)19 b(processor)h(has)f(to)g
(maintain)g(its)f(o)n(wn)h(ready-list)f(and)i(short-w)o(ak)o(eup)-150
1584 y(queue.)46 b(The)27 b(implementation)g(of)f(this)g(tw)o(o)h
(lists)e(dif)n(fers)h(slightly)h(from)-150 1667 y(the)c(single)h
(processor)g(v)o(ersion,)g(because)h(the)e(transfered)h(threads)f(has)h
(to)-150 1750 y(be)16 b(remo)o(v)o(ed)g(from)f(the)h(ready)g(list)e
(and)i(short)g(w)o(ak)o(eup)h(queue)f(and)g(inserted)-150
1833 y(to)j(the)g(destination)g(processor')l(s)h(lists.)-150
2026 y Fc(4.4.2)73 b(Thread)19 b(Contr)o(ol)g(Bloc)o(k)f(TCB)-150
2159 y Fm(Because)j(of)g(design)g(decision)g(2)g(it)f(is)g(suf)n
(\002cient)g(to)h(store)f(the)h(actual)g(pro-)-150 2242
y(cessor)f(number)h(of)f(each)g(thread.)26 b(That)19
b(is)g(the)h(id)g(of)f(the)h(destination)h(pro-)-150
2325 y(cessor)m(,)f(the)f(thread)h(w)o(as)f(last)g(mo)o(v)o(ed)i(to.)j
(This)19 b(number)h(will)f(be)g(stored)h(in)-150 2408
y(the)f(tcb)m(.)-150 2492 y Fb(Pr)m(o)o(visional)g(x86)e
(implementation:)-150 2575 y Fi(Bits)23 b(16\22619)f(of)g(the)h
Fb(pr)m(oc)f(id)h Fi(\002eld,)g(added)g(to)g(the)f(TCB,)g(are)h(used)f
(to)g(encode)i(the)-150 2658 y(processor)i(number)l(.)44
b(V)-7 b(alid)25 b(processor)h(numbers)f(are)g(1\22615.)43
b(F)o(or)25 b(compatibility)-150 2741 y(reasons,)17 b(the)h(processor)g
(number)g(0)f(means)g(\223in)m(v)n(alid\224.)-150 2950
y Fk(4.5)83 b(Current)23 b(Status)-150 3084 y Fm(The)f(current)g
(implementation)h(is)f(in)f(the)h(startup)g(phase.)34
b(The)21 b(Bootstrap)-150 3167 y(Processor)c(starts)f(up)h(the)g
(single)f(processor)i(v)o(ersion)f(of)g(L4)f(and)i(initialises)-150
3250 y(its)i(o)n(wn)g(and)h(all)f(global)g(data)h(structures.)27
b(Then)20 b(it)g(sends)h(a)f(startup)g(ipi)g(to)-150
3333 y(all)e(processors)i(e)o(xcept)g(him)f(and)h(w)o(aits)e(for)h
(them)g(to)g(initialise)f(themself.)-67 3416 y(Ne)o(xt)d(step)h(is)f
(to)g(implement)h(the)g(initialisation)f(of)g(the)h(local)f(data)h
(struc-)-150 3499 y(tures)24 b(and)g(get)f(the)h(APs)f(into)h(a)f
(state)g(where)h(to)g(w)o(ait)f(for)g(a)h(thread)g(to)f(be)-150
3582 y(mo)o(v)o(ed)d(to)f(them)g(e)o(xplicitely)-5 b(,)19
b(i.e.)j(bring)d(up)h(the)f(local)g(dispatcher)h(thread.)-150
3665 y(Then)g(we)g(ha)o(v)o(e)g(to)f(focus)i(on)f(the)g(changed)h
(system)f(calls)g(and)g(implement)-150 3748 y(the)f(system)g(calls.)
-150 3983 y Fn(A)100 b(x86)28 b(SMP)h(Har)n(d)o(ware)-150
4143 y Fm(In)17 b(the)g(x86)h(Symmetric)f(Multi)g(Processors)g(Ppro,)g
(PII)f(and)i(PIII)e(each)i(pro-)-150 4226 y(cessor)28
b(has)f(pri)n(v)n(ate)h(L1)f(and)h(L2)f(caches)h(the)f(ram)h(and)g
(other)f(the)g(other)-150 4310 y(periferal)20 b(components)i(are)e
(shared)h(and)g(accessible)f(via)g(the)h(system)f(b)o(us.)-150
4393 y(In)e(addition)g(an)g(APIC-based)g(inter)o(-processor)g
(interrupt)g(netw)o(ork)g(e)o(xists.)-150 4476 y(The)30
b(follo)n(wing)g(sections)g(describe)h(some)f(hardw)o(aremechanisms)j
(pro-)-150 4559 y(vided)20 b(by)f(in)g(a)g(x86)h(SMP)e(machine.)-150
4768 y Fk(A.1)83 b(Bus)23 b(loc)n(king)-150 4902 y Fm(In)28
b(multi)f(processor)i(systems)f(read,)j(modify)-5 b(,)30
b(write)d(memory)i(accesses)-150 4985 y(lik)o(e)20 b(bts,)f(xchg,)i
(xadd,)g(...)j(are)c(coherenc)o(y)i(critical,)c(because)j(tw)o(o)f
(concur)o(-)-150 5068 y(rent)f(threads)h(may)g(read)g(the)f(same)h
(memory)g(location,)g(modify)g(the)f(v)n(alue)-150 5151
y(and)h(write)f(it)f(back)j(in)e(some)h(order)l(.)k(The)c(contents)g
(of)f(this)g(memory)i(loca-)-150 5234 y(tion)j(is)g(unde\002ned,)i
(because)g(either)e(the)g(\002rst)f(or)h(the)h(second)g(may)f(write)
-150 5317 y(its)c(v)n(alue)i(\002rst.)29 b(So)20 b(some)i(hardw)o(are)g
(mechanism)g(is)f(needed)h(to)f(serialise)-150 5400 y(this)26
b(combined)i(instructions.)47 b(The)26 b(x86)h(SMP)f(hardw)o(are)i
(does)f(this)f(by)2049 -67 y(locking)19 b(the)f(system)g(b)o(us)g(for)g
(the)g(duration)h(of)f(this)f(single)h(instruction,)h(so)2049
16 y(before)g(reading)g(the)f(memory)h(location,)g(the)f(b)o(us)g(is)g
(lock)o(ed,)h(the)g(read)f(and)2049 99 y(the)f(modify)h(are)g
(performed)g(and)g(after)f(writing)g(the)g(changed)i(v)n(alue)f(back,)
2049 182 y(the)26 b(b)o(us)h(is)f(released.)46 b(T)-6
b(o)26 b(a)o(v)o(oid)g(b)o(us)g(locking)h(for)g(read,)h(modify)-5
b(,)28 b(write)2049 265 y(operations)d(to)e(non)h(critical)f(memory)i
(locations,)f(the)g(x86)g(hardw)o(are)h(in-)2049 348
y(troduces)f(the)e(lock)i(pre\002x)e(to)h(de\002ne)g(wheter)g(the)g(b)o
(us)g(should)g(be)h(lock)o(ed)2049 431 y(during)c(this)e(operation)i
(or)f(not.)2049 678 y Fk(A.2)83 b(Cac)o(he)24 b(coherenc)o(y)2049
825 y Fm(In)19 b(the)g(old)g(P1)f(SMPs)g(all)g(accesses)i(to)f(shared)g
(memory)h(locations)f(passes)2049 908 y(the)h(caches)h(and)f(touches)h
(the)f(memory)h(directly)-5 b(.)27 b(In)20 b(Ppro)f(and)i(later)f(pro-)
2049 991 y(cessors,)f(shared)g(memory)h(locations)f(are)f(cached,)i
(too.)j(T)-6 b(o)18 b(k)o(eep)i(the)f(data)2049 1074
y(coherent,)j(the)e(L2)h(caches)g(snoop)h(the)f(system)g(b)o(us)f(and)h
(perform)g(a)g(Mod-)2049 1157 y(i\002ed)j(Exclusi)n(v)o(e)h(Shared)g
(In)m(v)n(alidate)g(\(MESI\))f(protocol.)40 b(If)24 b(a)h(processor)
2049 1240 y(reads)g(a)f(memory)i(location)f(initially)-5
b(,)25 b(it)e(gets)i(e)o(xclusi)n(v)o(e)g(access)h(for)e(that)2049
1323 y(memory)f(location.)34 b(That)22 b(line)g(is)g(cached)h(in)f(its)
g(local)g(L2)g(cache.)34 b(In)23 b(the)2049 1406 y(case)k(that)f
(another)h(processor)h(then)f(reads)g(from)f(the)h(same)g(place,)h
(both)2049 1489 y(cachelines)20 b(are)f(shared.)k(No)n(w)-5
b(,)19 b(if)f(one)i(processor)g(modi\002es)f(a)f(shared)i(line)2049
1572 y(the)f(snooping)h(mechanism)g(of)f(the)g(L2)f(caches)i(detects,)f
(that)f(this)h(speci\002c)2049 1655 y(line)i(is)g(modi\002ed)g(in)g(a)g
(dif)n(ferent)g(cache)h(and)g(in)m(v)n(alidates)f(it.)29
b(The)21 b(writing)2049 1738 y(processor)f(gets)f(e)o(xclusi)n(v)o(e)h
(o)n(wnership)g(of)f(this)g(line.)2049 1984 y Fk(A.3)83
b(The)23 b(APIC)g(netw)n(ork)2049 2131 y Fm(In)h(the)h(x86)g(SMP)f
(machines)h(each)g(processor)h(has)e(to)h(ha)o(v)o(e)f(a)g(local)h(Ad-)
2049 2214 y(v)n(anced)i(Programmable)f(Interrupt)g(Controller)f(that)h
(replicates)f(the)h(PIC)2049 2297 y(functions)g(and)g(adds)f(some)h
(more)f(features)g(lik)o(e)g(Inter)g(Processor)h(Inter)o(-)2049
2380 y(rupts)21 b(IPIs.)28 b(The)21 b(peripherals)g(are)g(connected)i
(to)e(one)g(or)g(more)g(IO-APIC)2049 2463 y(units)30
b(that)f(performs)i(the)f(other)g(side)g(of)f(the)h(PICs.)55
b(All)29 b(local)h(APICs)2049 2546 y(and)24 b(the)g(IO-APICs)e(are)i
(connected)h(via)f(a)f(three)h(line)f(APIC)g(b)o(us)h(with)f(a)2049
2629 y(frequenc)o(y)i(of)e(32)h(MHz.)37 b(F)o(or)23 b(hardw)o(are)i
(interrupts,)f(the)f(IO-APICs)g(get)2049 2712 y(the)e(interrupt)h(and)f
(sends)h(it)f(via)g(the)g(APIC)g(b)o(us)g(to)g(the)g(assigned)i(w)o
(aiting)2049 2795 y(APIC)k(unit)h(\(That)g(earlier)f(performed)i(an)f
(IRQ,...\).)49 b(The)28 b(local)g(APICs)2049 2878 y(add)19
b(some)h(more)f(functionality:)k(self)c(interrupts)f(and)i(inter)e
(processor)i(in-)2049 2961 y(terrupts)25 b(IPIs.)40 b(Self)24
b(interrupts)i(are)f(usually)g(timer)g(interrupts)g(from)g(the)2049
3044 y(local)e(APIC)g(clock.)37 b(Inter)23 b(processor)i(interrupts)e
(are)g(softw)o(are)h(initiated)2049 3128 y(interrupts)j(on)g(a)f
(speci\002ed)h(set)f(of)h(destination)g(processors.)47
b(Similar)25 b(to)2049 3211 y(hardw)o(are)20 b(interrupts,)f(IPIs)f
(are)h(transmitted)g(via)g(the)f(APIC)g(b)o(us.)2132
3301 y(Lik)o(e)j(interrupts)g(from)g(hardw)o(are)g(the)g(IPIs)f(may)h
(be)h(used)f(to)g(enter)g(the)2049 3384 y(k)o(ernel)i(mode)h
(asynchronus)h(from)e(the)f(destinations)i(processor)g(point)f(of)2049
3467 y(vie)n(w)-5 b(,)28 b(b)o(ut)e(synchronus)i(from)e(the)h(IPI')l(s)
e(source,)j(thought)f(the)o(y)g(may)f(be)2049 3550 y(used)20
b(to)e(synchronize)j(operations)f(on)g(tw)o(o)f(processors.)2132
3641 y(At)e(startup)i(each)f(processor)h(is)f(halted)g(and)h(its)e
(local)h(APIC)f(w)o(aits)h(for)g(a)2049 3724 y(speci\002c)h(startup)g
(IPI.)2049 3995 y Fn(B)100 b(Long)27 b(IPC)2049 4169
y Fm(At)19 b(last)h(we)f(lik)o(e)h(to)g(present)h(some)f(prethoughts)h
(on)g(implementing)f(cross)2049 4252 y(processor)29 b(IPC)f(for)g(the)g
(long)h(IPC)e(case.)52 b(W)-6 b(e)28 b(ha)o(v)o(e)g(not)h(yet)f
(startet)g(to)2049 4335 y(implement)g(cross)f(processor)i(IPC)d(at)h
(all,)h(so)g(the)f(stuf)n(f)g(in)g(this)g(chapter)2049
4418 y(will)18 b(be)i(much)g(speculati)n(v)o(e)g(and)g(without)g(we)f
(are)g(not)h(sure)g(if)e(we)i(need)g(to)2049 4501 y(implement)f(an)o(y)
h(of)f(this)f(ideas)i(and)f(what)g(we)g(get)g(of)g(it.)2049
4747 y Fk(B.1)83 b(T)-5 b(emporarl)o(y)23 b(transf)o(ering)g(the)g
(Sender)2049 4894 y Fm(F)o(or)h(long)h(IPC,)e(the)h(mailbox)o(es)h(of)f
(the)h(destination)g(processors)g(proxies)2049 4977 y(may)18
b(be)f(a)h(bottleneck,)g(so)g(it)e(might)i(perhaps)g(pay)h(to)e
(transfer)g(the)h(sending)2049 5060 y(thread)e(to)g(the)g(recei)n
(ving')l(s)h(processor)f(for)g(the)g(time)f(of)h(the)g(long)h(IPC.)d
(This)2049 5143 y(of)24 b(course)g(has)g(to)f(be)h(transparent)g(to)g
(all)f(other)h(user)f(le)n(v)o(el)h(threads.)37 b(F)o(or)2049
5227 y(the)19 b(k)o(ernel)g(point)g(of)f(vie)n(w)-5 b(,)19
b(this)f(thread)h(simply)f(replaces)h(a)g(k)o(ernel)g(proxy)-5
b(.)2132 5317 y(This)21 b(idea)h(may)g(e)n(v)o(en)h(be)e(impro)o(v)o
(ed)i(by)f(ha)o(ving)g(a)g(set)f(of)h(proxies)g(and)2049
5400 y(using)e(this)e(temporary)i(transfer)f(only)g(if)g(all)f(proxies)
i(are)f(b)o(usy)-5 b(.)1931 5700 y(4)p eop
%%Page: 5 5
5 4 bop 1387 -300 a Fq(\227)20 b(Dr)o(aft)h(of)f(December)g(10,)f(1999)
g(\227)-150 -67 y Fk(B.2)83 b(IPC)24 b(within)e(a)h(Thread)g(T)-7
b(ransf)o(er)-150 66 y Fm(Especially)20 b(for)g(long)h(cross)f
(processor)h(IPC)e(it)g(is)h(hard)g(to)g(restart)g(the)g(IPC)-150
150 y(if)g(the)h(destination)g(is)g(transfered)g(to)f(another)i
(processor)l(.)30 b(Se)n(v)o(eral)20 b(copies)-150 233
y(are)c(still)g(made)h(and)g(ha)o(v)o(e)g(to)f(be)h(redone,)h(though)f
(the)o(y)g(are)g(v)n(alid.)22 b(Imagine)-150 316 y(a)g(long)g(IPC)f(of)
h(full)f(4)h(MB)g(and)h(by)f(accident)h(each)f(time)g(the)f(last)h
(byte)g(is)-150 399 y(to)f(be)h(wrote,)f(the)g(thread)h(is)f
(transfered.)30 b(It)21 b(is)g(then)h(a)f(bad)h(idea)f(to)g(restart)
-150 482 y(with)e(the)g(\002rst)e(byte.)-150 674 y Fc(B.2.1)73
b(Conceptual)18 b(Pr)o(ob)o(lems)-150 807 y Fm(As)h(long)i(as)e(we)h
(implement)g(the)g(\002rst)f(mechanism,)h(enabling)h(a)f(thread)g(to)
-150 890 y(detect)f(IPC)f(if)g(it)h(happens,)h(there)f(is)f(no)i
(conceptual)g(problem.)k(W)-6 b(e)18 b(de\002ne)-150
973 y(IPC)29 b(to)g(be)h(cross)g(processor)h(if)e(the)h(last)f(byte)h
(transfered)g(is)g(via)f(cross)-150 1056 y(processor)20
b(IPC.)-67 1139 y(The)h(second)h(mechanism)g(is)e(quite)h(more)g(dif)n
(\002cult,)g(because)h(we)f(ha)o(v)o(e)-150 1222 y(to)29
b(in)m(v)o(ok)o(e)h(a)g(f)o(ault)f(during)h(IPC)e(and)i(return)g(suf)n
(\002cient)f(information)h(to)-150 1305 y(restart)22
b(the)h(communication)h(on)f(that)g(e)o(xactly)g(point.)34
b(W)-6 b(e)22 b(not)h(yet)g(kno)n(w)-150 1389 y(if)d(we)h(need)h(this)e
(second)j(mechanism)f(at)e(all,)h(so)g(this)f(point)i(is)e(f)o(ar)h
(specu-)-150 1472 y(lati)n(v)o(e.)-150 1664 y Fc(B.2.2)73
b(Implementation)18 b(of)j(IPC)f(within)g(a)g(Thread)f(T)-6
b(ransf)o(er)-150 1797 y Fm(As)16 b(long)g(as)g(cross)g(processor)h
(IPC)e(is)g(performed)i(via)f(proxies)h(IPC)d(is)i(redi-)-150
1880 y(reted)23 b(to)g(another)h(processor')l(s)g(proxie,)h(using)f
(serv)o(er)o(-side)f(propagation.)-150 1963 y(If)15 b(we)h(implement)f
(to)h(temporarly)g(transfer)g(threads)g(to)f(the)h(recei)n(v)o(er')l(s)
g(pro-)-150 2046 y(cessor)m(,)j(we)g(ha)o(v)o(e)g(to)g(transfer)g
(both,)g(the)g(recei)n(v)o(er)g(and)h(the)f(sender)l(.)1931
5700 y(5)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
